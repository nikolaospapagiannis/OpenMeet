# CloudFlare Workers Configuration
# For edge rate limiting and DDoS protection

name = "openmeet-rate-limiter"
main = "workers/rate-limiter.ts"
compatibility_date = "2024-01-01"

# Production environment
[env.production]
name = "openmeet-rate-limiter-prod"
route = "api.openmeet.com/*"
vars = { ENVIRONMENT = "production" }

# Staging environment
[env.staging]
name = "openmeet-rate-limiter-staging"
route = "api-staging.openmeet.com/*"
vars = { ENVIRONMENT = "staging" }

# KV Namespaces for rate limiting
[[kv_namespaces]]
binding = "RATE_LIMIT_KV"
id = "YOUR_KV_NAMESPACE_ID"
preview_id = "YOUR_PREVIEW_KV_ID"

# Durable Objects for distributed rate limiting
[[durable_objects.bindings]]
name = "RATE_LIMITER"
class_name = "RateLimiter"
script_name = "openmeet-rate-limiter"

# D1 Database for persistent storage
[[d1_databases]]
binding = "DB"
database_name = "openmeet-rate-limits"
database_id = "YOUR_D1_DATABASE_ID"

# Analytics Engine binding
[[analytics_engine_datasets]]
binding = "ANALYTICS"

# Environment variables
[vars]
API_ORIGIN = "https://api.openmeet.com"
MAX_REQUEST_SIZE = "10485760"  # 10MB
