{
  "name": "Failed Login Attempts Spike",
  "tags": ["security", "authentication", "critical"],
  "rule_type_id": ".es-query",
  "params": {
    "size": 100,
    "timeWindowSize": 5,
    "timeWindowUnit": "m",
    "threshold": [10],
    "thresholdComparator": ">",
    "searchConfiguration": {
      "index": "logs-*",
      "query": {
        "query": "log_type:security AND (event:login_failed OR event:auth_failure)",
        "language": "kuery"
      }
    },
    "aggType": "count",
    "groupBy": "top",
    "termField": "client_ip",
    "termSize": 10
  },
  "schedule": {
    "interval": "1m"
  },
  "actions": [
    {
      "id": "slack-connector",
      "group": "query matched",
      "params": {
        "message": "⚠️ Failed Login Attempts Spike\n\nDetected multiple failed login attempts.\n\n*Count:* {{context.value}}\n*Threshold:* 10\n*IP:* {{context.group}}\n*Time:* {{context.date}}\n\nCheck Kibana: https://kibana.openmeet.com"
      }
    },
    {
      "id": "email-connector",
      "group": "query matched",
      "params": {
        "to": ["security@openmeet.com"],
        "subject": "⚠️ Security Alert - Failed Login Attempts",
        "message": "Multiple failed login attempts detected.\n\nCount: {{context.value}}\nIP: {{context.group}}\nTime: {{context.date}}"
      }
    }
  ],
  "notify_when": "onActionGroupChange",
  "throttle": "10m"
}
